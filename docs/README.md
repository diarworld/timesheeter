# Yandex Tracker Timesheet
Вы можете ознакомиться с подробной документацией о Timesheet, перейдя по [ссылке](https://diarworld.github.io/timesheeter/)
- [Основные возможности](#Основные-возможности)
- [Сборка и запуск приложения](#Сборка-и-запуск-приложения)
- [Запуск dev-сервера](#Запуск-dev-сервера)
- [Производственный календарь](#Производственный-календарь)

## Основные возможности
Timesheet возник из необходимости.
Yandex.Tracker отлично справляется с управлением задачами, но его возможности по учёту рабочего времени оставляют желать лучшего.
Разработчикам часто не хватает средства для редактирования записей времени, создания детализированных отчётов и эффективного управления своими рабочими часами.
Timesheet решает эти проблемы, предлагая интуитивно понятный и ориентированный на разработчиков подход.

Сервис предоставляет возможность:
* Массово **выгружать встречи из календаря** и заносить их в ворклоги яндекс трекера:
![calendar](calendar.png)

* Просматривать отчет о затраченном времени:
![reports](reports.png)

* Просматривать ошибки списания:
![alerts](alerts.png)

* Просматривать треки по задачам в виде таблицы c суммой треков по всем задачам и по каждой задаче в отдельности.  
По-умолчанию, в список попадают задачи, соответствующие условиям:
  * назначены на текущего пользователя
  * даты создания или обновления задач входят в выбранный диапазон (диапазон отображается в левом верхнем углу под текущей датой)
  * по задаче имеются треки от текущего пользователя, входящие в выбранный диапазон дат
  * закрепленные задачи  

* Управлять командой - добавлять и удалять юзеров.
![team](team.png)

Список задач также можно фильтровать по ответственному, статусам, очереди и названию задачи.
Все опции для фильтров берутся из настроек вашего Yandex Tracker.

* Закреплять/откреплять задачи по нажатию на значок рядом с ключом.
Закрепленные таким образом задачи будут всегда отображаться в таблице не зависимо от того на кого они назначены и когда были созданы/отредактированы  
Данные о закрепленных задачах хранятся в localstorage, по-этому, не синхронизируются между разными браузерами  
![pin.png](pin.png)

![timesheet.png](timesheet.png)
* Создавать треки по задаче. Создание возможно несколькими способами:
  * нажатием на ячейку на пересечении строки задачи с колонкой даты.  
  Если вы ошиблись номером задачи или датой, их можно изменить в появившемся модальном окне
  * нажатием на кнопку `Add new track` в верхнем левом углу страницы.
![create.png](create.png)

* Редактировать и удалять треки по задачам. Редактирование возможно 2 способами:
  * нажатием на галочку слева от ключа задачи, разворачиваем список треков. Изменяем текст комментария путем нажатия на текст в строке трека.  
  Время изменяем путем нажатия на внесенное время. Удалить трек можно нажав на иконку корзины слева от комментария к треку
  * нажатием на пересечение строки задачи и столбца даты, вызываем модальное окно создания трека, внизу которого видим  
  все треки внесенные по задаче на выбранную дату. Отсюда можно изменить дату, комментарий и время трека, а также удалить его, нажав на иконку корзины
![tracks.png](tracks.png)

## Сборка и запуск приложения

Для работы сервиса должна быть установлена [NodeJS](https://www.digitalocean.com/community/tutorials/node-js-ubuntu-18-04-ru#Установка-при-помощи-nvm),
а также указаны переменные окружения из таблицы ниже

| Переменная               | Тип     | Примечание                                                                                                                                                                                                                                                                                      | Обязательно |
|--------------------------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| CLIENT_ID                | string  | Yandex Oauth2 App ID.<br>https://passport.yandex.com/auth?retpath=https%3A%2F%2Foauth.yandex.com%2Fclient%2Fnew&noreturn=1&origin=oauth<br>В настройках необходимо указать:<br>Hostname: https://example.com<br>Redirect URI: https://example.com/token<br>Доступы: tracker:read, tracker:write | Да          |
| EWS_SERVICE_URL          | string  | URL сервиса Exchange Web Services для интеграции с календарем<br>Пример: https://owa.example.com/EWS/Exchange.asmx                                                                                                                | Нет         |
| EWS_DOMAIN               | string  | Домен для аутентификации в Exchange Web Services<br>Пример: EX1000                                                                                                                               | Нет         |
| DIFY_API_TOKEN           | string  | API токен для интеграции с Dify AI сервисом<br>Формат: app-1234567890123456                                                                                                                       | Нет         |
| DIFY_URL                 | string  | URL сервиса Dify для AI функциональности<br>Пример: http://dify.llm.svc.cluster.local                                                                                                            | Нет         |
| DIFY_COST                | number  | Стоимость запроса к Dify AI сервису<br>Пример: 0.00014                                                                                                                                           | Нет         |
| DATABASE_URL             | string  | URL подключения к основной базе данных PostgreSQL<br>Формат: postgresql://username:password@host:port/database                    | Да          |
| SHADOW_DATABASE_URL      | string  | URL подключения к теневой базе данных PostgreSQL для миграций<br>Формат: postgresql://username:password@host:port/database        | Нет         |
| SUPPORT_URL              | string  | URL канала поддержки<br>Пример: https://example.slack.com/example/channels/timesheet-support                                | Нет         |
| RESTORE_PASSWORD_URL     | string  | URL страницы восстановления пароля<br>Пример: https://example.com/restore                                                          | Нет         |
| COMPANY_DOMAIN           | string  | Домен компании для стандартных правил выгрузки из календаря<br>Пример: example.com                                                                                                 | Нет         |

### Команды для сборки и запуска приложения:
- Установка пакетов. 
  ```shell
  npm ci
  ```
  


- Сборка
  ```shell
  npm run build
  ```
- Запуск
  ```shell
  npm run start
  ```

- Вы также можете запустить приложение в контейнере
  ```shell
  docker build -t timesheet .
  
  # При запуске необходимо передать CLIENT_ID иначе контейнер не запустится
  # Для изменения значения переменной необходимо перезапустить docker run и указать новое значение -e CLIENT_ID=...
  docker run -ti -e CLIENT_ID=XXX -p 3000:3000 timesheet
  ```

При первом запуске приложения необходимо прописать ID организации. Его можно найти по ссылке https://tracker.yandex.com/admin/orgs

![start-page.png](start-page.png)


### Запуск dev-сервера
(доступен по адресу http://localhost:3000/)
  ```shell
    npm run ci
    npm run dev
  ```


#### Запуск через Docker
  ```shell
    docker-compose up --build
  ```
  ### Возможные проблемы
  
  - В режиме разработки в Google Chrome иногда возникает ошибка `400 Bad Request`, связанная с устаревшими куками. Чтобы её исправить, необходимо очистить куки в настройках браузера.

### Производственный календарь

Реализован на базе простого json по пути `src/entities/track/yandex/ui/YandexTimesheet/calendar.json`, взят из [репо](https://github.com/d10xa/holidays-calendar). В 2026 году нужно будет перекачать (иначе все будние дни будут считаться по 8 часов).